# 서버 DB 도입 계획 (Server Migration Plan)

사용자 데이터의 중복을 방지하고, 효율적인 자료 공유 및 관리를 위해 서버 사이드 데이터베이스 도입을 계획하고 있습니다.

## 1. 도입 목표
1.  **데이터 중복 제거**: 동일한 문장/단어에 대한 중복 데이터를 방지하고, 검증된 번역 및 발음 데이터 공유.
2.  **클라우드 백업 및 동기화**: 기기 변경 시에도 학습 기록 및 즐겨찾기 유지.
3.  **커뮤니티 검증**: 사용자 참여를 통한 데이터 품질 향상 (오류 제보, 추천 등).

## 2. 기술 스택 후보
*   **Firebase**: Flutter와의 높은 호환성, 실시간 데이터 동기화 강점.
*   **Supabase**: PostgreSQL 기반의 강력한 쿼리 기능, 오픈 소스 친화적.

## 3. 데이터 구조 설계 (안)
데이터는 크게 **공용 데이터**와 **개인 데이터**로 분리하여 관리합니다.

### A. 공용 데이터 (Shared Data)
*   모든 사용자가 공유하는 원본 언어 자료.
*   **필드**:
    - `id` (UUID)
    - `source_text` (원문)
    - `source_lang` (언어 코드)
    - `target_text` (번역문)
    - `target_lang` (언어 코드)
    - `phonetic` (발음 기호)
    - `usage_count` (참조 횟수)
*   **특징**: 읽기 전용에 가까우며, 관리자 또는 검증된 사용자만 수정 가능.

### B. 개인 데이터 (User Data)
*   사용자별 맞춤 설정 및 학습 진행 상황.
*   **필드**:
    - `user_id`
    - `shared_data_id` (공용 데이터 참조)
    - `is_favorite` (즐겨찾기 여부)
    - `correct_count` / `incorrect_count` (학습 통계)
    - `last_studied_at`
    - `user_notes` (개인 메모)

## 4. 하이브리드 검색 로직
앱 성능 최적화를 위해 로컬 DB와 서버 DB를 혼합하여 사용합니다.

1.  **검색 우선순위**: 로컬 캐시(SQLite) -> 서버 DB 순으로 검색.
2.  **데이터 동기화**:
    - 앱 실행 시 또는 명시적 요청 시 변경된 데이터 동기화.
    - 자주 사용하는 데이터는 로컬에 캐싱하여 오프라인 지원 및 속도 향상.

---

## 5. 향후 작업 목록 (Next Steps)

1.  [ ] **기술 스택 확정**: Firebase vs Supabase 장단점 비교 및 결정.
2.  [ ] **DB 스키마 상세 설계**: 구체적인 테이블 및 관계 정의.
3.  [ ] **API 연동 구현**: Flutter 앱 내 서버 통신 모듈 개발.
4.  [ ] **기존 데이터 마이그레이션**: 로컬 데이터를 서버 구조에 맞게 변환 및 업로드 도구 개발.
