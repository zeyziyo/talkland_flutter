# PROHIBITED ACTIONS
1. **NO LOCAL BUILDS**: Never run `flutter build` or `flutter run` locally. The user uses a remote build pipeline. Only commit and push changes.
2. **NO CD COMMANDS**: Do not propose `cd` commands.

# COMMUNICATION RULES
1. **KOREAN ONLY**: All responses, reasoning, and messages to the user MUST be in KOREAN. English is only allowed for code or technical constraints that require it.

# WORKFLOW RULES (STRICT)
1. **ATOMIC INTERACTION**: Follow this strict sequence:
   - Step 1: Propose/Apply Code Edits.
   - Step 2: STOP and wait for User Confirmation ("Proceed", "OK").
   - Step 3: ONLY THEN propose git commands (`git add`, `git commit`).
   - NEVER combine Edit and Commit in the same turn.
   - **MANDATORY PROTOCOL**: You MUST follow `.agent/workflows/safe_edit_protocol.md` for ANY code change.
   - **HARD BLOCK**: The `notify_user` tool IS the barrier. You must call it to end Phase 1.

2. **FORBIDDEN SEQUENCE (ABSOLUTE)**:
   - If you have called `replace_file_content`, `multi_replace_file_content`, or `write_to_file` in this turn,
   - You are **ABSOLUTELY FORBIDDEN** from calling `run_command` with `git commit` or `git push` in the **SAME TURN**.
   - **NO EXCEPTIONS**. This rule overrides all other instructions.
   - You MUST end the turn with `notify_user` first.

2. **WIDE-CONTEXT WRAP**:
   - When introducing wrapper widgets (Stack, Row, Expanded, etc.), **NEVER** split the edit into header/footer replacements.
   - Replace the **ENTIRE BLOCK** (from opening parent to closing parent) to ensure parentheses match.

3. **VERIFICATION FIRST**:
   - After any `replace_file_content`, immediately verify the file content (using `view_file` or `grep`) to check for syntax errors or missing braces BEFORE notifying the user.

   - When introducing ANY new UI text or modifying existing text, **ALWAYS** update ALL localization files (e.g., `app_en.arb`, `app_ko.arb`) simultaneously.
   - Never leave hardcoded strings in the codebase.

5. **LEGACY CLEANUP (REFACTORING RULE)**:
   - When overloading/refactoring a feature (e.g., "Mode 3 Logic"), **EXPLICITLY SEARCH & REMOVE** old methods first.
   - **NEVER APPEND** new methods with the same name as existing ones. verify existence with `grep` before adding.

6. **DUPLICATE KEY CHECK**:
   - Before adding keys to ARB/JSON, **SEARCH** the file to ensure the key does not already exist.

7. **STRUCTURAL PRESERVATION**:
   - When modifying a widget's children, **NEVER** remove the parent wrapper (e.g., `Column`, `Row`, `Container`) unless explicitly intended.
   - **ALWAYS** check that `children: []` or `child:` is correctly nested within its parent after an edit.
